<!DOCTYPE html>
<html>
    <head>
        <title>AWS S3 File Upload</title>
        <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.12.min.js"></script>
    </head>
    <body>
        <input type="file" id="file-chooser" />
        <button id="upload-button">Upload to S3</button>
        <div id="results"></div>
    
        <script type="text/javascript">
            const ENDPOINT_URL = "http://s3.amazonaws.com/fileuploadtestlf10/"
            const ACCESS_KEY_ID = "AKIAQ5GPLDKPVFEHD67F"
            const ACCESS_KEY_SECRET = "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"
            const BUCKET_NAME = "fileuploadtestlf10"
            const REGION = "eu-central-1"
            const SIGNATURE_VERSION = "v4"
            
            var bucket = new AWS.S3({
                accessKeyId: ACCESS_KEY_ID,
                secretAccessKey: ACCESS_KEY_SECRET,
                endpoint: new AWS.Endpoint(ENDPOINT_URL),
                signatureVersion: 'v4',
                region: 'eu-central-1',
                params: {
                    Bucket: BUCKET_NAME
                }
            })
            
            var fileChooser = document.getElementById('file-chooser')
            var button = document.getElementById('upload-button')
            var results = document.getElementById('results')
            
            button.addEventListener('click', function() {
                var file = fileChooser.files[0]
                results.innerHTML = ''
                if (!file) {
                    results.innerHTML = 'Nothing to upload.'
                    return
                }
                var params = {
                Key: 'demo/' + file.name,
                ContentType: file.type,
                Body: file,
                ACL: 'public-read',
                }

                var sqs = new AWS.SQS({apiVersion: '2012-11-05', accessKeyId:'AKIAQ5GPLDKPVFEHD67F', secretAccessKey:'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',region: 'eu-central-1'});
                var date = new Date,
                dateFormat = [date.getDate(),
                    date.getMonth()+1,
                    date.getFullYear()].join('-')+'_'+
                    [date.getHours(),
                    date.getMinutes(),
                    date.getSeconds()].join(':');

                var sqsParams = {
                // Remove DelaySeconds parameter and value for FIFO queues
                DelaySeconds: 10,
                MessageAttributes: {
                    "Title": {
                    DataType: "String",
                    StringValue: "Test String"
                    },
                    "Author": {
                    DataType: "String",
                    StringValue: "Paul, Paul, Timon - AWS"
                    },
                    "WeeksOn": {
                    DataType: "Number",
                    StringValue: "69"
                    }
                },
                MessageBody: dateFormat,
                QueueUrl: "https://sqs.eu-central-1.amazonaws.com/062711863967/lf10queue"
                };

            sqs.sendMessage(sqsParams, function(err, data) {
            if (err) {
                console.log("Error", err);
            } else {
                console.log("Success", data.MessageId);
            }
            })

            bucket.putObject(params, function(err, data) {
                if (err) {
                    results.innerHTML = 'ERROR: ' + err;
                    return
                    }
                    listObjs()
            })
            }, false)
            
            function listObjs() {
                bucket.listObjects({Prefix: 'demo'}, function(err, data) {
                    if (err) {
                        results.innerHTML = 'ERROR: ' + err;
                        return
                    }
                    var objKeys = "";
                    data.Contents.forEach(function(obj) {
                        objKeys += obj.Key + "<br>"
                    });
                    results.innerHTML = objKeys
                })
            }
        </script>
    </body>
</html>