name: Deploy Infrastructure

on: [push]

jobs:
  tf_fmt:
    name: Deploy Services
    runs-on: ubuntu-latest
    steps:

      - name: Checkout Repo
      - uses: actions/checkout@v2

      - name: Terraform Init
      - uses: hashicorp/setup-terraform@1.0.0
        with:
          cli_config_credentials_token: ${{ secrets.TFC_API_KEY }}

      - name: Terraform Init
      - uses: terraform init

      - name: Terraform Format
      - uses: terraform fmt -check

      - name: Terraform Validate
      - uses: terraform validate

      - name: Terraform Plan
      - uses: terraform plan

      - name: Terraform Apply
      - uses: terraform apply -auto-approve